\hypertarget{rates_8py_source}{}\section{/home/hilton/github/exch2exh/rates.py}

\begin{DoxyCode}
\Hypertarget{rates_8py_source_l00001}\hyperlink{namespacerates}{00001} \textcolor{comment}{# -*- coding: utf-8 -*-}
00002 \textcolor{stringliteral}{"""}
00003 \textcolor{stringliteral}{Created on Mon Aug  7 23:25:51 2017}
00004 \textcolor{stringliteral}{}
00005 \textcolor{stringliteral}{@author: hilton}
00006 \textcolor{stringliteral}{"""}
00007 \textcolor{keyword}{import} math           \textcolor{comment}{# trunc()}
00008 \textcolor{keyword}{import} time           \textcolor{comment}{# time()}
00009 \textcolor{keyword}{import} datetime       \textcolor{comment}{# class datetime}
00010 \textcolor{keyword}{import} urllib.request \textcolor{comment}{# urlopen()}
00011 
\Hypertarget{rates_8py_source_l00012}\hyperlink{classrates_1_1_rate}{00012} \textcolor{keyword}{class }\hyperlink{classrates_1_1_rate}{Rate}: 
\Hypertarget{rates_8py_source_l00013}\hyperlink{classrates_1_1_rate_a935221ad61f9c683e6da812ac7f53cc3}{00013}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_rate_a935221ad61f9c683e6da812ac7f53cc3}{\_\_init\_\_} (self, source, target, rate): 
\Hypertarget{rates_8py_source_l00014}\hyperlink{classrates_1_1_rate_a82a6abb7536f2a4393f43456cfb1dc5e}{00014}         self.\hyperlink{classrates_1_1_rate_a82a6abb7536f2a4393f43456cfb1dc5e}{source} = source
\Hypertarget{rates_8py_source_l00015}\hyperlink{classrates_1_1_rate_adb1bbb0977c838106cb181a5941612c8}{00015}         self.\hyperlink{classrates_1_1_rate_adb1bbb0977c838106cb181a5941612c8}{target} = target
\Hypertarget{rates_8py_source_l00016}\hyperlink{classrates_1_1_rate_a5a660cfdfaa515a6e5809492525d61a7}{00016}         self.\hyperlink{classrates_1_1_rate_a5a660cfdfaa515a6e5809492525d61a7}{rate}   = rate        
00017         
\Hypertarget{rates_8py_source_l00018}\hyperlink{classrates_1_1_rates}{00018} \textcolor{keyword}{class }\hyperlink{classrates_1_1_rates}{Rates}:
00019 \textcolor{comment}{#    def \_\_init\_\_ (self):}
00020 \textcolor{comment}{#        print (self.\_\_class\_\_.\_\_name\_\_)}
00021 
00022     \textcolor{comment}{# TODO create a function where the source and target coin are params}
00023     
\Hypertarget{rates_8py_source_l00024}\hyperlink{namespacerates_a083f2cdcd71554d301bcbfb0779ffa49}{00024}     \textcolor{keyword}{def }\hyperlink{namespacerates_a083f2cdcd71554d301bcbfb0779ffa49}{getBrl2Usd} (self):
00025         \textcolor{keywordflow}{return} self.brl2usd
00026     
\Hypertarget{rates_8py_source_l00027}\hyperlink{namespacerates_ae4c7203ef8a919f9cf522581ca00b08a}{00027}     \textcolor{keyword}{def }\hyperlink{namespacerates_ae4c7203ef8a919f9cf522581ca00b08a}{getUsd2Brl} (self):
00028         \textcolor{keywordflow}{return} self.usd2brl
00029     
\Hypertarget{rates_8py_source_l00030}\hyperlink{namespacerates_a5dd7b6601bc66e313c26984e32f1e290}{00030}     \textcolor{keyword}{def }\hyperlink{namespacerates_a5dd7b6601bc66e313c26984e32f1e290}{getServiceName} (self):
00031         \textcolor{keywordflow}{return} self.service
00032     
\Hypertarget{rates_8py_source_l00033}\hyperlink{namespacerates_aafc179b32863137b88c74dd0ee2576bd}{00033}     \textcolor{keyword}{def }\hyperlink{namespacerates_aafc179b32863137b88c74dd0ee2576bd}{getServicePrefix} (self):
00034         \textcolor{keywordflow}{return} self.prefix
00035         
\Hypertarget{rates_8py_source_l00036}\hyperlink{namespacerates_a2f1a70c33ee9e255938e4c19fd207264}{00036}     \textcolor{keyword}{def }\hyperlink{namespacerates_a2f1a70c33ee9e255938e4c19fd207264}{\_\_str\_\_} (self):
00037         result = \textcolor{stringliteral}{''}
00038 
00039         service = self.service
00040         dt      = self.dt
00041         usd2brl = self.usd2brl
00042         brl2usd = self.brl2usd
00043         ftupl = (service, dt, usd2brl, brl2usd)
00044         
00045         result = \textcolor{stringliteral}{"\{0\}: \{1\}: USD2BRL \{2:.4f\}, BRL2USD \{3:.4f\}"}.format (*ftupl)
00046 
00047         \textcolor{keywordflow}{return} result        
00048     
00049     \textcolor{keywordflow}{pass} 
00050     
\Hypertarget{rates_8py_source_l00051}\hyperlink{classrates_1_1_google}{00051} \textcolor{keyword}{class }\hyperlink{classrates_1_1_google}{Google} (\hyperlink{classrates_1_1_rates}{Rates}):
00052     \textcolor{comment}{#    U\_USD2BRL = 'https://www.google.com/finance/converter?a=1&from=USD&to=BRL'}
\Hypertarget{rates_8py_source_l00053}\hyperlink{classrates_1_1_google_a77ef7f5932c48b002697fb187a234d4a}{00053}     U\_USD2BRL = \textcolor{stringliteral}{'
      https://finance.google.com/finance/converter?a=1&from=USD&to=BRL&meta=ei%3DoKi6WfnPAsSTeoKNoJAB'}
00054 \textcolor{comment}{#    U\_BRL2USD = 'https://www.google.com/finance/converter?a=1&from=BRL&to=USD'}
\Hypertarget{rates_8py_source_l00055}\hyperlink{classrates_1_1_google_a46dbc3fa0a110bf5b66808c29642cfa1}{00055}     U\_BRL2USD = \textcolor{stringliteral}{'
      https://finance.google.com/finance/converter?a=1&from=BRL&to=USD&meta=ei%3DYqi6Wej-AoyEeoLbh9gF'}
00056 
\Hypertarget{rates_8py_source_l00057}\hyperlink{classrates_1_1_google_afa49252959b89741449dca773f2141b8}{00057}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_google_afa49252959b89741449dca773f2141b8}{get\_rate} (url):
00058         result = 0
00059     
00060         f = urllib.request.urlopen (url)
00061         
00062         \textcolor{keywordflow}{try}:
00063             line = f.readline ()
00064             \textcolor{keywordflow}{while} line != b\textcolor{stringliteral}{''}:
00065                 ind = line.find (b\textcolor{stringliteral}{'currency\_converter'})
00066                 \textcolor{keywordflow}{if} ind != -1:
00067                     
00068                     fields = line.split ()
00069                     rate = fields[5].split (b\textcolor{stringliteral}{'>'})[1]
00070                     
00071                     \textcolor{keywordflow}{break}
00072                     
00073                 line = f.readline ()
00074             
00075             result = float (rate)
00076         \textcolor{keywordflow}{except} IndexError \textcolor{keyword}{as} err:
00077             result = 0.0
00078             
00079             fmt = \textcolor{stringliteral}{"Google.get\_rate(): \{0\}"}
00080             \textcolor{keywordflow}{print} (fmt.format (err))
00081             
00082             \textcolor{keywordflow}{raise}
00083         
00084         \textcolor{comment}{# Normal function termination}
00085         \textcolor{keywordflow}{return} result
00086 
\Hypertarget{rates_8py_source_l00087}\hyperlink{classrates_1_1_google_a6d9d023db3b4f6f2b585397e3469c396}{00087}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_google_a6d9d023db3b4f6f2b585397e3469c396}{\_\_init\_\_} (self):
00088         ts = math.trunc (time.time () + 0.5)
\Hypertarget{rates_8py_source_l00089}\hyperlink{classrates_1_1_google_a76574be36237f78780f76bed53e69ab2}{00089}         self.\hyperlink{classrates_1_1_google_a76574be36237f78780f76bed53e69ab2}{dt} = datetime.datetime.fromtimestamp (ts)
00090                 
\Hypertarget{rates_8py_source_l00091}\hyperlink{classrates_1_1_google_a94c28f6d60d5d6afc075416d7378471c}{00091}         self.\hyperlink{classrates_1_1_google_a94c28f6d60d5d6afc075416d7378471c}{usd2brl} = Google.get\_rate (Google.U\_USD2BRL)
\Hypertarget{rates_8py_source_l00092}\hyperlink{classrates_1_1_google_a0979ffcb18b8bf3156cc5735c67ca6df}{00092}         self.\hyperlink{classrates_1_1_google_a0979ffcb18b8bf3156cc5735c67ca6df}{brl2usd} = Google.get\_rate (Google.U\_BRL2USD)
00093                 
\Hypertarget{rates_8py_source_l00094}\hyperlink{classrates_1_1_google_a1da08e36d5007aa5293d048b625a35e9}{00094}         self.\hyperlink{classrates_1_1_google_a1da08e36d5007aa5293d048b625a35e9}{service} = \textcolor{stringliteral}{"Google"}
\Hypertarget{rates_8py_source_l00095}\hyperlink{classrates_1_1_google_ada5de8700ad571d0ab819fa0163d6bbe}{00095}         self.\hyperlink{classrates_1_1_google_ada5de8700ad571d0ab819fa0163d6bbe}{prefix} = \textcolor{stringliteral}{"ggl"}
00096                 
00097         \textcolor{comment}{# Normal function termination}
00098         \textcolor{keywordflow}{return}
00099             
\Hypertarget{rates_8py_source_l00100}\hyperlink{classrates_1_1_x_rates}{00100} \textcolor{keyword}{class }\hyperlink{classrates_1_1_x_rates}{XRates} (\hyperlink{classrates_1_1_rates}{Rates}):
\Hypertarget{rates_8py_source_l00101}\hyperlink{classrates_1_1_x_rates_ab3bd64c08e6503f0d76c9f73dc38fa25}{00101}     U\_XRATES = \textcolor{stringliteral}{'http://www.x-rates.com/table/?from=USD&amount=1'}
00102 
\Hypertarget{rates_8py_source_l00103}\hyperlink{classrates_1_1_x_rates_a034e274f1bf0a2509af2621eb27c7cce}{00103}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_x_rates_a034e274f1bf0a2509af2621eb27c7cce}{get\_rates} ():        
00104         \textcolor{comment}{# Adding a fake browser User-Agent to make site x-rates.com happy}
00105         headers = \{\textcolor{stringliteral}{'User-Agent'} : \textcolor{stringliteral}{'Mozilla 5.10'}\}
00106             
00107         \textcolor{comment}{# Create the Request, joining URL and User-Agent}
00108         request = urllib.request.Request (XRates.U\_XRATES, headers = headers)
00109     
00110         \textcolor{comment}{# Open the URL as file}
00111         f = urllib.request.urlopen (request)
00112         
00113         \textcolor{comment}{# Input over the file to get the rates}
00114         line = \textcolor{keywordtype}{None}
00115         \textcolor{keywordflow}{while} line != b\textcolor{stringliteral}{''}:
00116             line = f.readline ()
00117             ind = line.find (b\textcolor{stringliteral}{'BRL'})
00118             \textcolor{keywordflow}{if} ind == -1:
00119                 \textcolor{keywordflow}{continue} 
00120             
00121             ind = line.find (b\textcolor{stringliteral}{'rtRates'})
00122             \textcolor{keywordflow}{if} ind == -1:
00123                 \textcolor{keywordflow}{continue} 
00124                     
00125             \textcolor{keywordflow}{if} line.find (b\textcolor{stringliteral}{'from=USD'}) != -1:
00126                 fields = line.split (b\textcolor{stringliteral}{'>'})
00127                 
00128                 susd = fields[2].split (b\textcolor{stringliteral}{'<'})[0]
00129                 usd2brl = float (susd)
00130             
00131             \textcolor{keywordflow}{elif} line.find (b\textcolor{stringliteral}{'from=BRL'}) != -1:
00132                 fields = line.split (b\textcolor{stringliteral}{'>'})
00133                 
00134                 sbrl = fields[2].split (b\textcolor{stringliteral}{'<'})[0]
00135                 brl2usd = float (sbrl)
00136                 
00137         result = (usd2brl, brl2usd)
00138         
00139         \textcolor{keywordflow}{return} result
00140 
\Hypertarget{rates_8py_source_l00141}\hyperlink{classrates_1_1_x_rates_a86fb4ba66a218c5f25b5b2c1f2a8345b}{00141}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_x_rates_a86fb4ba66a218c5f25b5b2c1f2a8345b}{\_\_init\_\_} (self):
00142 \textcolor{comment}{#        print (self.\_\_class\_\_.\_\_name\_\_)}
00143 
00144         ts = math.trunc (time.time () + 0.5)
\Hypertarget{rates_8py_source_l00145}\hyperlink{classrates_1_1_x_rates_aa7835a0ac1d41af607d6d5885b49c131}{00145}         self.\hyperlink{classrates_1_1_x_rates_aa7835a0ac1d41af607d6d5885b49c131}{dt} = datetime.datetime.fromtimestamp (ts)
00146 
\Hypertarget{rates_8py_source_l00147}\hyperlink{classrates_1_1_x_rates_acb0a8b6ec059b823c8a46eb115341251}{00147}         self.usd2brl, self.\hyperlink{classrates_1_1_x_rates_acb0a8b6ec059b823c8a46eb115341251}{brl2usd} = XRates.get\_rates () 
00148                 
\Hypertarget{rates_8py_source_l00149}\hyperlink{classrates_1_1_x_rates_ad80e3c0295deaa15fac085324716747f}{00149}         self.\hyperlink{classrates_1_1_x_rates_ad80e3c0295deaa15fac085324716747f}{service} = \textcolor{stringliteral}{"XRates"}
\Hypertarget{rates_8py_source_l00150}\hyperlink{classrates_1_1_x_rates_a3b92b41b0fbd77b44d01f094ff83dd9d}{00150}         self.\hyperlink{classrates_1_1_x_rates_a3b92b41b0fbd77b44d01f094ff83dd9d}{prefix} = \textcolor{stringliteral}{"xr"}
00151 
00152 \textcolor{comment}{# class Yahoo (Rates):}
00153 \textcolor{comment}{#    pass}
00154 
\end{DoxyCode}

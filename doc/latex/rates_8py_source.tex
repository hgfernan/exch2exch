\hypertarget{rates_8py_source}{}\section{/home/hilton/github/exch2exh/rates.py}

\begin{DoxyCode}
\hypertarget{rates_8py_source.tex_l00001}{}\hyperlink{namespacerates}{00001} \textcolor{comment}{# -*- coding: utf-8 -*-}
00002 \textcolor{stringliteral}{"""}
00003 \textcolor{stringliteral}{Created on Mon Aug  7 23:25:51 2017}
00004 \textcolor{stringliteral}{}
00005 \textcolor{stringliteral}{@author: hilton}
00006 \textcolor{stringliteral}{"""}
00007 \textcolor{keyword}{import} math           \textcolor{comment}{# trunc()}
00008 \textcolor{keyword}{import} time           \textcolor{comment}{# time()}
00009 \textcolor{keyword}{import} datetime       \textcolor{comment}{# class datetime}
00010 \textcolor{keyword}{import} urllib.request \textcolor{comment}{# urlopen()}
00011 
\hypertarget{rates_8py_source.tex_l00012}{}\hyperlink{classrates_1_1_rate}{00012} \textcolor{keyword}{class }\hyperlink{classrates_1_1_rate}{Rate}: 
\hypertarget{rates_8py_source.tex_l00013}{}\hyperlink{classrates_1_1_rate_a935221ad61f9c683e6da812ac7f53cc3}{00013}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_rate_a935221ad61f9c683e6da812ac7f53cc3}{\_\_init\_\_} (self, source, target, rate): 
\hypertarget{rates_8py_source.tex_l00014}{}\hyperlink{classrates_1_1_rate_a82a6abb7536f2a4393f43456cfb1dc5e}{00014}         self.\hyperlink{classrates_1_1_rate_a82a6abb7536f2a4393f43456cfb1dc5e}{source} = source
\hypertarget{rates_8py_source.tex_l00015}{}\hyperlink{classrates_1_1_rate_adb1bbb0977c838106cb181a5941612c8}{00015}         self.\hyperlink{classrates_1_1_rate_adb1bbb0977c838106cb181a5941612c8}{target} = target
\hypertarget{rates_8py_source.tex_l00016}{}\hyperlink{classrates_1_1_rate_a5a660cfdfaa515a6e5809492525d61a7}{00016}         self.\hyperlink{classrates_1_1_rate_a5a660cfdfaa515a6e5809492525d61a7}{rate}   = rate        
00017         
\hypertarget{rates_8py_source.tex_l00018}{}\hyperlink{classrates_1_1_rates}{00018} \textcolor{keyword}{class }\hyperlink{classrates_1_1_rates}{Rates}:
00019 \textcolor{comment}{#    def \_\_init\_\_ (self):}
00020 \textcolor{comment}{#        print (self.\_\_class\_\_.\_\_name\_\_)}
00021     
\hypertarget{rates_8py_source.tex_l00022}{}\hyperlink{namespacerates_a083f2cdcd71554d301bcbfb0779ffa49}{00022}     \textcolor{keyword}{def }\hyperlink{namespacerates_a083f2cdcd71554d301bcbfb0779ffa49}{getBrl2Usd} (self):
00023         \textcolor{keywordflow}{return} self.brl2usd
00024     
\hypertarget{rates_8py_source.tex_l00025}{}\hyperlink{namespacerates_ae4c7203ef8a919f9cf522581ca00b08a}{00025}     \textcolor{keyword}{def }\hyperlink{namespacerates_ae4c7203ef8a919f9cf522581ca00b08a}{getUsd2Brl} (self):
00026         \textcolor{keywordflow}{return} self.usd2brl
00027     
\hypertarget{rates_8py_source.tex_l00028}{}\hyperlink{namespacerates_a5dd7b6601bc66e313c26984e32f1e290}{00028}     \textcolor{keyword}{def }\hyperlink{namespacerates_a5dd7b6601bc66e313c26984e32f1e290}{getServiceName} (self):
00029         \textcolor{keywordflow}{return} self.service
00030     
\hypertarget{rates_8py_source.tex_l00031}{}\hyperlink{namespacerates_aafc179b32863137b88c74dd0ee2576bd}{00031}     \textcolor{keyword}{def }\hyperlink{namespacerates_aafc179b32863137b88c74dd0ee2576bd}{getServicePrefix} (self):
00032         \textcolor{keywordflow}{return} self.prefix
00033         
\hypertarget{rates_8py_source.tex_l00034}{}\hyperlink{namespacerates_a2f1a70c33ee9e255938e4c19fd207264}{00034}     \textcolor{keyword}{def }\hyperlink{namespacerates_a2f1a70c33ee9e255938e4c19fd207264}{\_\_str\_\_} (self):
00035         result = \textcolor{stringliteral}{''}
00036 
00037         service = self.service
00038         dt      = self.dt
00039         usd2brl = self.usd2brl
00040         brl2usd = self.brl2usd
00041         ftupl = (service, dt, usd2brl, brl2usd)
00042         
00043         result = \textcolor{stringliteral}{"\{0\}: \{1\}: USD2BRL \{2:.4f\}, BRL2USD \{3:.4f\}"}.format (*ftupl)
00044 
00045         \textcolor{keywordflow}{return} result        
00046     
00047     \textcolor{keywordflow}{pass} 
00048     
\hypertarget{rates_8py_source.tex_l00049}{}\hyperlink{classrates_1_1_google}{00049} \textcolor{keyword}{class }\hyperlink{classrates_1_1_google}{Google} (\hyperlink{classrates_1_1_rates}{Rates}):
00050     \textcolor{comment}{#    U\_USD2BRL = 'https://www.google.com/finance/converter?a=1&from=USD&to=BRL'}
\hypertarget{rates_8py_source.tex_l00051}{}\hyperlink{classrates_1_1_google_a77ef7f5932c48b002697fb187a234d4a}{00051}     U\_USD2BRL = \textcolor{stringliteral}{'
      https://finance.google.com/finance/converter?a=1&from=USD&to=BRL&meta=ei%3DoKi6WfnPAsSTeoKNoJAB'}
00052 \textcolor{comment}{#    U\_BRL2USD = 'https://www.google.com/finance/converter?a=1&from=BRL&to=USD'}
\hypertarget{rates_8py_source.tex_l00053}{}\hyperlink{classrates_1_1_google_a46dbc3fa0a110bf5b66808c29642cfa1}{00053}     U\_BRL2USD = \textcolor{stringliteral}{'
      https://finance.google.com/finance/converter?a=1&from=BRL&to=USD&meta=ei%3DYqi6Wej-AoyEeoLbh9gF'}
00054 
\hypertarget{rates_8py_source.tex_l00055}{}\hyperlink{classrates_1_1_google_afa49252959b89741449dca773f2141b8}{00055}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_google_afa49252959b89741449dca773f2141b8}{get\_rate} (url):
00056         result = 0
00057     
00058         f = urllib.request.urlopen (url)
00059         
00060         \textcolor{keywordflow}{try}:
00061             line = f.readline ()
00062             \textcolor{keywordflow}{while} line != b\textcolor{stringliteral}{''}:
00063                 ind = line.find (b\textcolor{stringliteral}{'currency\_converter'})
00064                 \textcolor{keywordflow}{if} ind != -1:
00065                     
00066                     fields = line.split ()
00067                     rate = fields[5].split (b\textcolor{stringliteral}{'>'})[1]
00068                     
00069                     \textcolor{keywordflow}{break}
00070                     
00071                 line = f.readline ()
00072             
00073             result = float (rate)
00074         \textcolor{keywordflow}{except} IndexError \textcolor{keyword}{as} err:
00075             result = 0.0
00076             
00077             fmt = \textcolor{stringliteral}{"Google.get\_rate(): \{0\}"}
00078             \textcolor{keywordflow}{print} (fmt.format (err))
00079             
00080             \textcolor{keywordflow}{raise}
00081         
00082         \textcolor{comment}{# Normal function termination}
00083         \textcolor{keywordflow}{return} result
00084 
\hypertarget{rates_8py_source.tex_l00085}{}\hyperlink{classrates_1_1_google_a6d9d023db3b4f6f2b585397e3469c396}{00085}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_google_a6d9d023db3b4f6f2b585397e3469c396}{\_\_init\_\_} (self):
00086         ts = math.trunc (time.time () + 0.5)
\hypertarget{rates_8py_source.tex_l00087}{}\hyperlink{classrates_1_1_google_a76574be36237f78780f76bed53e69ab2}{00087}         self.\hyperlink{classrates_1_1_google_a76574be36237f78780f76bed53e69ab2}{dt} = datetime.datetime.fromtimestamp (ts)
00088                 
\hypertarget{rates_8py_source.tex_l00089}{}\hyperlink{classrates_1_1_google_a94c28f6d60d5d6afc075416d7378471c}{00089}         self.\hyperlink{classrates_1_1_google_a94c28f6d60d5d6afc075416d7378471c}{usd2brl} = Google.get\_rate (Google.U\_USD2BRL)
\hypertarget{rates_8py_source.tex_l00090}{}\hyperlink{classrates_1_1_google_a0979ffcb18b8bf3156cc5735c67ca6df}{00090}         self.\hyperlink{classrates_1_1_google_a0979ffcb18b8bf3156cc5735c67ca6df}{brl2usd} = Google.get\_rate (Google.U\_BRL2USD)
00091                 
\hypertarget{rates_8py_source.tex_l00092}{}\hyperlink{classrates_1_1_google_a1da08e36d5007aa5293d048b625a35e9}{00092}         self.\hyperlink{classrates_1_1_google_a1da08e36d5007aa5293d048b625a35e9}{service} = \textcolor{stringliteral}{"Google"}
\hypertarget{rates_8py_source.tex_l00093}{}\hyperlink{classrates_1_1_google_ada5de8700ad571d0ab819fa0163d6bbe}{00093}         self.\hyperlink{classrates_1_1_google_ada5de8700ad571d0ab819fa0163d6bbe}{prefix} = \textcolor{stringliteral}{"ggl"}
00094                 
00095         \textcolor{comment}{# Normal function termination}
00096         \textcolor{keywordflow}{return}
00097             
\hypertarget{rates_8py_source.tex_l00098}{}\hyperlink{classrates_1_1_x_rates}{00098} \textcolor{keyword}{class }\hyperlink{classrates_1_1_x_rates}{XRates} (\hyperlink{classrates_1_1_rates}{Rates}):
\hypertarget{rates_8py_source.tex_l00099}{}\hyperlink{classrates_1_1_x_rates_ab3bd64c08e6503f0d76c9f73dc38fa25}{00099}     U\_XRATES = \textcolor{stringliteral}{'http://www.x-rates.com/table/?from=USD&amount=1'}
00100 
\hypertarget{rates_8py_source.tex_l00101}{}\hyperlink{classrates_1_1_x_rates_a034e274f1bf0a2509af2621eb27c7cce}{00101}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_x_rates_a034e274f1bf0a2509af2621eb27c7cce}{get\_rates} ():        
00102         \textcolor{comment}{# Adding a fake browser User-Agent to make site x-rates.com happy}
00103         headers = \{\textcolor{stringliteral}{'User-Agent'} : \textcolor{stringliteral}{'Mozilla 5.10'}\}
00104             
00105         \textcolor{comment}{# Create the Request, joining URL and User-Agent}
00106         request = urllib.request.Request (XRates.U\_XRATES, headers = headers)
00107     
00108         \textcolor{comment}{# Open the URL as file}
00109         f = urllib.request.urlopen (request)
00110         
00111         \textcolor{comment}{# Input over the file to get the rates}
00112         line = \textcolor{keywordtype}{None}
00113         \textcolor{keywordflow}{while} line != b\textcolor{stringliteral}{''}:
00114             line = f.readline ()
00115             ind = line.find (b\textcolor{stringliteral}{'BRL'})
00116             \textcolor{keywordflow}{if} ind == -1:
00117                 \textcolor{keywordflow}{continue} 
00118             
00119             ind = line.find (b\textcolor{stringliteral}{'rtRates'})
00120             \textcolor{keywordflow}{if} ind == -1:
00121                 \textcolor{keywordflow}{continue} 
00122                     
00123             \textcolor{keywordflow}{if} line.find (b\textcolor{stringliteral}{'from=USD'}) != -1:
00124                 fields = line.split (b\textcolor{stringliteral}{'>'})
00125                 
00126                 susd = fields[2].split (b\textcolor{stringliteral}{'<'})[0]
00127                 usd2brl = float (susd)
00128             
00129             \textcolor{keywordflow}{elif} line.find (b\textcolor{stringliteral}{'from=BRL'}) != -1:
00130                 fields = line.split (b\textcolor{stringliteral}{'>'})
00131                 
00132                 sbrl = fields[2].split (b\textcolor{stringliteral}{'<'})[0]
00133                 brl2usd = float (sbrl)
00134                 
00135         result = (usd2brl, brl2usd)
00136         
00137         \textcolor{keywordflow}{return} result
00138 
\hypertarget{rates_8py_source.tex_l00139}{}\hyperlink{classrates_1_1_x_rates_a86fb4ba66a218c5f25b5b2c1f2a8345b}{00139}     \textcolor{keyword}{def }\hyperlink{classrates_1_1_x_rates_a86fb4ba66a218c5f25b5b2c1f2a8345b}{\_\_init\_\_} (self):
00140 \textcolor{comment}{#        print (self.\_\_class\_\_.\_\_name\_\_)}
00141 
00142         ts = math.trunc (time.time () + 0.5)
\hypertarget{rates_8py_source.tex_l00143}{}\hyperlink{classrates_1_1_x_rates_aa7835a0ac1d41af607d6d5885b49c131}{00143}         self.\hyperlink{classrates_1_1_x_rates_aa7835a0ac1d41af607d6d5885b49c131}{dt} = datetime.datetime.fromtimestamp (ts)
00144 
\hypertarget{rates_8py_source.tex_l00145}{}\hyperlink{classrates_1_1_x_rates_acb0a8b6ec059b823c8a46eb115341251}{00145}         self.usd2brl, self.\hyperlink{classrates_1_1_x_rates_acb0a8b6ec059b823c8a46eb115341251}{brl2usd} = XRates.get\_rates () 
00146                 
\hypertarget{rates_8py_source.tex_l00147}{}\hyperlink{classrates_1_1_x_rates_ad80e3c0295deaa15fac085324716747f}{00147}         self.\hyperlink{classrates_1_1_x_rates_ad80e3c0295deaa15fac085324716747f}{service} = \textcolor{stringliteral}{"XRates"}
\hypertarget{rates_8py_source.tex_l00148}{}\hyperlink{classrates_1_1_x_rates_a3b92b41b0fbd77b44d01f094ff83dd9d}{00148}         self.\hyperlink{classrates_1_1_x_rates_a3b92b41b0fbd77b44d01f094ff83dd9d}{prefix} = \textcolor{stringliteral}{"xr"}
00149 
00150 \textcolor{comment}{# class Yahoo (Rates):}
00151 \textcolor{comment}{#    pass}
00152 
\end{DoxyCode}
